<!DOCTYPE html>
<html lang="ko">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Git Merge Game</title>
   <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap" rel="stylesheet">
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }
       
       body {
           font-family: 'Pretendard', sans-serif;
           background: #2a2a2a;
           color: #ffffff;
           min-height: 100vh;
       }
       
       .container {
           max-width: 600px;
           margin: 0 auto;
           padding: 40px;
           display: flex;
           align-items: center;
           justify-content: center;
           min-height: 100vh;
       }
       
       .screen {
           display: none;
           background: #3a3a3a;
           border-radius: 20px;
           padding: 40px;
           box-shadow: 0 20px 40px rgba(0,0,0,0.3);
           width: 100%;
           text-align: center;
       }
       
       .screen.active {
           display: block;
       }
       
       .header {
           margin-bottom: 40px;
       }
       
       .header h1 {
           font-size: 2.5rem;
           font-weight: 700;
           color: #ffffff;
           margin-bottom: 10px;
       }
       
       .subtitle {
           color: #cccccc;
           font-size: 1rem;
           font-weight: 500;
       }
       
       input {
           width: 100%;
           padding: 15px 20px;
           font-size: 1rem;
           border-radius: 10px;
           border: 1px solid #4a4a4a;
           background: #2a2a2a;
           color: #ffffff;
           margin: 12px 0;
           transition: all 0.3s ease;
           font-family: inherit;
       }
       
       input:focus {
           outline: none;
           border-color: #666666;
           background: #333333;
       }
       
       input::placeholder {
           color: #999999;
       }
       
       .btn {
           width: 100%;
           background: #4a4a4a;
           color: white;
           border: none;
           padding: 15px 30px;
           border-radius: 10px;
           font-size: 1.1rem;
           font-weight: 600;
           cursor: pointer;
           transition: all 0.3s ease;
           margin: 12px 0;
           font-family: inherit;
       }
       
       .btn:hover {
           background: #555555;
           transform: translateY(-2px);
       }
       
       .btn:disabled {
           background: #333333;
           color: #666666;
           cursor: not-allowed;
           transform: none;
       }
       
       .btn-group {
           display: flex;
           gap: 15px;
           justify-content: center;
           margin-top: 30px;
       }
       
       .btn-group .btn {
           width: auto;
       }
       
       .mode-grid {
           display: grid;
           grid-template-columns: 1fr 1fr;
           gap: 20px;
           margin: 30px 0;
       }
       
       .mode-btn {
           padding: 40px 20px;
           background: #2a2a2a;
           border: 1px solid #4a4a4a;
           border-radius: 12px;
           text-align: center;
           cursor: pointer;
           transition: all 0.3s ease;
       }
       
       .mode-btn:hover {
           background: #333333;
           border-color: #666666;
       }
       
       .mode-btn div {
           font-size: 1.2rem;
           font-weight: 600;
           margin-bottom: 8px;
           color: #ffffff;
       }
       
       .mode-btn small {
           color: #999999;
           font-size: 0.9rem;
       }
       
       .difficulty-grid {
           display: grid;
           grid-template-columns: 1fr 1fr;
           gap: 15px;
           margin: 30px 0;
       }
       
       .difficulty-btn {
           padding: 20px;
           text-align: center;
           border: 2px solid #4a4a4a;
           border-radius: 10px;
           cursor: pointer;
           background: #2a2a2a;
           transition: all 0.3s ease;
       }
       
       .difficulty-btn:hover {
           background: #333333;
           border-color: #666666;
       }
       
       .difficulty-btn.selected {
           border-color: #00aa00;
           background: #1a3a1a;
       }
       
       .difficulty-btn div {
           font-weight: 600;
           margin-bottom: 5px;
           color: #ffffff;
       }
       
       .difficulty-btn small {
           color: #999999;
           font-size: 0.85rem;
       }
       
       .game-container {
           display: none;
           position: fixed;
           top: 0;
           left: 0;
           right: 0;
           bottom: 0;
           background: #1a1a1a;
           z-index: 1000;
       }
       
       .game-container.active {
           display: flex;
           flex-direction: column;
       }
       
       .game-header {
           background: #2a2a2a;
           padding: 15px 20px;
           display: flex;
           justify-content: space-between;
           align-items: center;
           border-bottom: 1px solid #333;
           flex-shrink: 0;
       }
       
       .game-info {
           display: flex;
           gap: 30px;
           align-items: center;
       }
       
       .timer, .score-display {
           color: #ffffff;
           font-weight: 600;
       }
       
       .game-content {
           display: flex;
           flex: 1;
           min-height: 0;
       }
       
       .conflict-area {
           flex: 1;
           padding: 40px;
           background: #1a1a1a;
           display: flex;
           flex-direction: column;
           align-items: center;
           justify-content: center;
           min-width: 0;
       }
       
       .conflict-container {
           width: 100%;
           max-width: 800px;
           background: #2a2a2a;
           border-radius: 12px;
           padding: 30px;
           box-shadow: 0 4px 20px rgba(0,0,0,0.3);
       }
       
       .file-header {
           background: #3a3a3a;
           padding: 15px 20px;
           border-radius: 8px;
           margin-bottom: 20px;
           color: #ffffff;
           font-weight: 600;
           font-family: 'SF Mono', 'Courier New', monospace;
           text-align: center;
           font-size: 1.1rem;
       }
       
       .code-editor {
           width: 100%;
           height: 400px;
           background: #0f0f0f;
           color: #ffffff;
           border: 1px solid #333;
           border-radius: 8px;
           padding: 20px;
           font-family: 'SF Mono', 'Courier New', monospace;
           font-size: 14px;
           line-height: 1.5;
           resize: none;
           outline: none;
       }
       
       .code-editor:focus {
           border-color: #555;
           box-shadow: 0 0 0 2px rgba(85, 85, 85, 0.3);
       }
       
       .game-sidebar {
           width: 350px;
           background: #2a2a2a;
           padding: 30px;
           border-left: 1px solid #333;
           overflow-y: auto;
           flex-shrink: 0;
       }
       
       .sidebar-section {
           margin-bottom: 30px;
       }
       
       .sidebar-title {
           color: #cccccc;
           font-size: 1rem;
           margin-bottom: 15px;
           font-weight: 600;
       }
       
       .status-item {
           display: flex;
           justify-content: space-between;
           align-items: center;
           padding: 12px 0;
           border-bottom: 1px solid #333;
           color: #ffffff;
       }
       
       .status-item:last-child {
           border-bottom: none;
       }
       
       .status-value {
           font-weight: 600;
           color: #00aa00;
       }
       
       .game-controls {
           display: flex;
           flex-direction: column;
           gap: 12px;
           margin-top: 30px;
       }
       
       .game-button {
           padding: 15px 20px;
           background: #4a4a4a;
           border: none;
           border-radius: 8px;
           color: #ffffff;
           cursor: pointer;
           font-family: inherit;
           font-weight: 500;
           font-size: 1rem;
       }
       
       .game-button:hover {
           background: #555555;
       }
       
       .game-button.primary {
           background: #00aa00;
       }
       
       .game-button.primary:hover {
           background: #00cc00;
       }
       
       .hint {
           background: #333;
           padding: 20px;
           border-radius: 8px;
           margin-top: 20px;
           font-size: 0.9rem;
           color: #cccccc;
           text-align: center;
       }
       
       .result-message {
           margin-top: 20px;
           padding: 15px;
           border-radius: 8px;
           text-align: center;
           font-weight: bold;
           font-size: 1rem;
       }
       
       .result-message.success {
           background: #1a4a1a;
           color: #00ff00;
           border: 1px solid #00aa00;
       }
       
       .result-message.error {
           background: #4a1a1a;
           color: #ff4444;
           border: 1px solid #aa0000;
       }
       
       .result-screen {
           text-align: center;
           padding: 60px 40px;
       }
       
       .final-score {
           font-size: 4rem;
           font-weight: 700;
           color: #00aa00;
           margin: 30px 0;
       }
       
       .result-stats {
           display: grid;
           grid-template-columns: 1fr 1fr;
           gap: 20px;
           margin: 30px 0;
       }
       
       .result-stat {
           background: #2a2a2a;
           padding: 20px;
           border-radius: 10px;
           text-align: center;
       }
       
       .result-stat-value {
           font-size: 2rem;
           font-weight: 600;
           color: #ffffff;
           margin-bottom: 5px;
       }
       
       .result-stat-label {
           color: #999999;
           font-size: 0.9rem;
       }
   </style>
</head>
<body>
   <div class="container">
       <div class="screen active" id="nicknameScreen">
           <div class="header">
               <h1>Git Merge Game</h1>
               <p class="subtitle">당신의 Git merge 실력을 테스트해보세요</p>
           </div>
           <input type="text" id="nicknameInput" placeholder="닉네임을 입력하세요" maxlength="16">
           <button class="btn" id="enterBtn" disabled>입장하기</button>
       </div>

       <div class="screen" id="modeScreen">
           <div class="header">
               <h1>모드 선택</h1>
           </div>
           <div class="mode-grid">
               <div class="mode-btn" onclick="showSoloDifficulty()">
                   <div>혼자하기</div>
                   <small>솔로 모드</small>
               </div>
               <div class="mode-btn" onclick="startBattle()">
                   <div>실시간 대전</div>
                   <small>멀티플레이어</small>
               </div>
           </div>
       </div>

       <div class="screen" id="difficultyScreen">
           <div class="header">
               <h1>난이도 선택</h1>
           </div>
           <div class="difficulty-grid">
               <div class="difficulty-btn" data-difficulty="EASY">
                   <div>쉬움</div>
                   <small>3개 충돌</small>
               </div>
               <div class="difficulty-btn" data-difficulty="NORMAL">
                   <div>보통</div>
                   <small>5개 충돌</small>
               </div>
               <div class="difficulty-btn" data-difficulty="HARD">
                   <div>어려움</div>
                   <small>8개 충돌</small>
               </div>
               <div class="difficulty-btn" data-difficulty="HELL">
                   <div>지옥</div>
                   <small>12개 충돌</small>
               </div>
           </div>
           <button class="btn" id="startSoloBtn" disabled>게임 시작</button>
           <button class="btn" onclick="showScreen('modeScreen')">뒤로</button>
       </div>

       <div class="screen" id="resultScreen">
           <div class="result-screen">
               <h1>게임 완료!</h1>
               <div class="final-score" id="finalScore">1500</div>
               <div class="result-stats">
                   <div class="result-stat">
                       <div class="result-stat-value" id="accuracyRate">85%</div>
                       <div class="result-stat-label">정확도</div>
                   </div>
                   <div class="result-stat">
                       <div class="result-stat-value" id="finalTime">02:34</div>
                       <div class="result-stat-label">소요시간</div>
                   </div>
                   <div class="result-stat">
                       <div class="result-stat-value" id="totalSolved">7/8</div>
                       <div class="result-stat-label">해결률</div>
                   </div>
                   <div class="result-stat">
                       <div class="result-stat-value" id="cleanlinessScore">92%</div>
                       <div class="result-stat-label">깔끔함</div>
                   </div>
               </div>
               <button class="btn" onclick="showScreen('modeScreen')">다시하기</button>
           </div>
       </div>
   </div>

   <div class="game-container" id="gameContainer">
       <div class="game-header">
           <h2>Git Merge Game</h2>
           <div class="game-info">
               <div class="timer">시간: <span id="gameTimer">00:00</span></div>
               <div class="score-display">점수: <span id="gameScore">0</span></div>
           </div>
       </div>
       
       <div class="game-content">
           <div class="conflict-area">
               <div class="conflict-container">
                   <div class="file-header" id="fileHeader">src/main/conflict.js</div>
                   <textarea class="code-editor" id="codeEditor" placeholder="충돌을 해결하세요..."></textarea>
                   <div class="hint">
                       Git 충돌 마커(&lt;&lt;&lt;&lt;&lt;&lt;&lt;, =======, &gt;&gt;&gt;&gt;&gt;&gt;&gt;)를 제거하고 올바른 코드만 남기세요!
                   </div>
                   <div class="result-message" id="resultMessage" style="display: none;"></div>
               </div>
           </div>
           
           <div class="game-sidebar">
               <div class="sidebar-section">
                   <div class="sidebar-title">게임 상태</div>
                   <div class="status-item">
                       <span>문제</span>
                       <span class="status-value" id="questionStatus">1/3</span>
                   </div>
                   <div class="status-item">
                       <span>정답</span>
                       <span class="status-value" id="correctCount">0</span>
                   </div>
                   <div class="status-item">
                       <span>오답</span>
                       <span class="status-value" id="wrongCount">0</span>
                   </div>
                   <div class="status-item">
                       <span>시간</span>
                       <span class="status-value" id="timeElapsed">00:00</span>
                   </div>
               </div>
               
               <div class="game-controls">
                   <button class="game-button primary" id="submitBtn">답안 제출</button>
                   <button class="game-button" onclick="endGame()">게임 종료</button>
               </div>
           </div>
       </div>
   </div>

   <script>
       let nickname = '';
       let selectedDifficulty = '';
       let currentSession = null;
       let gameStartTime = null;
       let gameTimer = null;
       
       document.getElementById('nicknameInput').addEventListener('input', function() {
           document.getElementById('enterBtn').disabled = this.value.trim().length < 2;
       });
       
       document.getElementById('enterBtn').addEventListener('click', function() {
           nickname = document.getElementById('nicknameInput').value.trim();
           localStorage.setItem('gitmerge_nickname', nickname);
           showScreen('modeScreen');
       });
       
       document.querySelectorAll('.difficulty-btn').forEach(btn => {
           btn.addEventListener('click', function() {
               document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
               this.classList.add('selected');
               selectedDifficulty = this.dataset.difficulty;
               document.getElementById('startSoloBtn').disabled = false;
           });
       });
       
       document.getElementById('startSoloBtn').addEventListener('click', startSoloGame);
       document.getElementById('submitBtn').addEventListener('click', submitAnswer);
       
       function showSoloDifficulty() {
           showScreen('difficultyScreen');
       }
       
       function startBattle() {
           window.location.href = 'battle.html';
       }
       
       async function startSoloGame() {
           try {
               const response = await fetch('/api/game/start', {
                   method: 'POST',
                   headers: { 'Content-Type': 'application/json' },
                   body: JSON.stringify({
                       userId: 1,
                       difficulty: selectedDifficulty
                   })
               });
               
               if (response.ok) {
                   const data = await response.json();
                   currentSession = data;
                   gameStartTime = Date.now();
                   displayConflict();
                   document.getElementById('gameContainer').classList.add('active');
                   startTimer();
               } else {
                   alert('게임 시작 실패');
               }
           } catch (error) {
               alert('서버 연결 오류');
           }
       }
       
       function displayConflict() {
           if (!currentSession || !currentSession.conflicts) return;
           
           const conflict = currentSession.conflicts[0];
           document.getElementById('fileHeader').textContent = conflict.fileName;
           document.getElementById('codeEditor').value = conflict.conflictMarkers;
           document.getElementById('questionStatus').textContent = `1/${currentSession.totalConflicts}`;
       }
       
       async function submitAnswer() {
           const answer = document.getElementById('codeEditor').value.trim();
           const conflict = currentSession.conflicts[0];
           
           try {
               const response = await fetch('/api/game/resolve', {
                   method: 'POST',
                   headers: { 'Content-Type': 'application/json' },
                   body: JSON.stringify({
                       sessionId: currentSession.sessionId,
                       fileName: conflict.fileName,
                       resolution: answer
                   })
               });
               
               if (response.ok) {
                   const result = await response.json();
                   showResult(result);
                   
                   if (result.correct) {
                       updateCorrectCount();
                   } else {
                       updateWrongCount();
                   }
                   
                   if (result.gameCompleted) {
                       setTimeout(showFinalResult, 2000);
                   }
               }
           } catch (error) {
               alert('제출 오류');
           }
       }
       
       function showResult(result) {
           const messageDiv = document.getElementById('resultMessage');
           messageDiv.textContent = result.correct ? '정답입니다!' : '틀렸습니다. 다시 시도하세요.';
           messageDiv.className = result.correct ? 'result-message success' : 'result-message error';
           messageDiv.style.display = 'block';
           
           setTimeout(() => {
               messageDiv.style.display = 'none';
           }, 2000);
       }
       
       function updateCorrectCount() {
           const current = parseInt(document.getElementById('correctCount').textContent);
           document.getElementById('correctCount').textContent = current + 1;
       }
       
       function updateWrongCount() {
           const current = parseInt(document.getElementById('wrongCount').textContent);
           document.getElementById('wrongCount').textContent = current + 1;
       }
       
       async function showFinalResult() {
           try {
               const response = await fetch('/api/game/finish/' + currentSession.sessionId, {
                   method: 'POST'
               });
               
               if (response.ok) {
                   const result = await response.json();
                   
                   document.getElementById('finalScore').textContent = result.totalScore;
                   document.getElementById('accuracyRate').textContent = result.accuracy + '%';
                   document.getElementById('finalTime').textContent = 
                       Math.floor(result.elapsedTime / 60) + ':' + 
                       String(result.elapsedTime % 60).padStart(2, '0');
                   document.getElementById('totalSolved').textContent = 
                       `${result.correctCount}/${result.totalConflicts}`;
                   document.getElementById('cleanlinessScore').textContent = result.cleanliness + '%';
                   
                   endGame();
                   showScreen('resultScreen');
               }
           } catch (error) {
               endGame();
               showScreen('resultScreen');
           }
       }
       
       function startTimer() {
           gameTimer = setInterval(() => {
               if (gameStartTime) {
                   const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
                   const minutes = Math.floor(elapsed / 60);
                   const seconds = elapsed % 60;
                   document.getElementById('timeElapsed').textContent = 
                       String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
                   document.getElementById('gameTimer').textContent = 
                       String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
               }
           }, 1000);
       }
       
       function endGame() {
           if (gameTimer) {
               clearInterval(gameTimer);
               gameTimer = null;
           }
           document.getElementById('gameContainer').classList.remove('active');
       }
       
       function showScreen(screenId) {
           document.querySelectorAll('.screen').forEach(screen => {
               screen.classList.remove('active');
           });
           document.getElementById(screenId).classList.add('active');
       }
   </script>
</body>
</html>
