<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Merge Game</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Pretendard", -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: #0a0a0a;
            color: #e8e8e8;
            line-height: 1.5;
            overflow: hidden;
        }

        .game-container {
            height: 100vh;
            display: grid;
            grid-template-columns: 280px 1fr 240px;
            grid-template-rows: 56px 1fr 48px;
            grid-template-areas: 
                "header header header"
                "sidebar editor status"
                "footer footer footer";
        }

        .header {
            grid-area: header;
            background: #111111;
            border-bottom: 1px solid #1a1a1a;
            display: flex;
            align-items: center;
            padding: 0 24px;
            justify-content: space-between;
        }

        .logo {
            font-size: 16px;
            font-weight: 700;
            color: #6366f1;
        }

        .game-info {
            display: flex;
            gap: 32px;
            align-items: center;
            font-size: 13px;
            font-weight: 500;
        }

        .timer {
            color: #f43f5e;
            font-weight: 600;
        }

        .score {
            color: #10b981;
            font-weight: 600;
        }

        .sidebar {
            grid-area: sidebar;
            background: #0a0a0a;
            border-right: 1px solid #1a1a1a;
            padding: 24px;
            overflow-y: auto;
        }

        .conflicts-list {
            list-style: none;
        }

        .conflict-item {
            background: #111111;
            border: 1px solid #1a1a1a;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .conflict-item:hover {
            border-color: #6366f1;
            background: #0f0f23;
        }

        .conflict-item.active {
            border-color: #6366f1;
            background: #0f0f23;
        }

        .conflict-item.resolved {
            border-color: #10b981;
            background: #0f1419;
            opacity: 0.7;
        }

        .conflict-filename {
            font-size: 13px;
            font-weight: 600;
            color: #e8e8e8;
            margin-bottom: 6px;
        }

        .conflict-status {
            font-size: 11px;
            color: #737373;
            font-weight: 500;
        }

        .conflict-status.resolved {
            color: #10b981;
        }

        .editor-area {
            grid-area: editor;
            background: #0a0a0a;
            position: relative;
        }

        .editor {
            width: 100%;
            height: 100%;
            background: #0a0a0a;
            color: #e8e8e8;
            border: none;
            padding: 24px;
            font-family: 'JetBrains Mono', 'SF Mono', Monaco, monospace;
            font-size: 13px;
            line-height: 1.7;
            resize: none;
            outline: none;
        }

        .editor:focus {
            background: #050505;
        }

        .status-panel {
            grid-area: status;
            background: #0a0a0a;
            border-left: 1px solid #1a1a1a;
            padding: 24px;
        }

        .progress-section {
            margin-bottom: 32px;
        }

        .progress-title {
            font-size: 11px;
            color: #737373;
            text-transform: uppercase;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #1a1a1a;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #6366f1;
            transition: width 0.3s ease;
        }

        .stats {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .stat-label {
            color: #737373;
            font-weight: 500;
        }

        .stat-value {
            color: #e8e8e8;
            font-weight: 600;
        }

        .footer {
            grid-area: footer;
            background: #111111;
            border-top: 1px solid #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 0 24px;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #1a1a1a;
            border-radius: 6px;
            background: #111111;
            color: #e8e8e8;
            font-family: inherit;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .btn:hover {
            background: #1a1a1a;
            border-color: #2a2a2a;
        }

        .btn.primary {
            background: #6366f1;
            border-color: #6366f1;
            color: #ffffff;
        }

        .btn.primary:hover {
            background: #5855eb;
            border-color: #5855eb;
        }

        .btn.danger {
            background: #f43f5e;
            border-color: #f43f5e;
            color: #ffffff;
        }

        .btn.danger:hover {
            background: #e11d48;
            border-color: #e11d48;
        }

        .difficulty-selector {
            margin-bottom: 24px;
        }

        .difficulty-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .difficulty-btn {
            padding: 12px;
            font-size: 11px;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .difficulty-btn.easy { border-color: #10b981; }
        .difficulty-btn.normal { border-color: #6366f1; }
        .difficulty-btn.hard { border-color: #f59e0b; }
        .difficulty-btn.hell { border-color: #f43f5e; }

        .difficulty-btn.active.easy { background: #10b981; color: #ffffff; }
        .difficulty-btn.active.normal { background: #6366f1; color: #ffffff; }
        .difficulty-btn.active.hard { background: #f59e0b; color: #ffffff; }
        .difficulty-btn.active.hell { background: #f43f5e; color: #ffffff; }

        .game-start-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .start-content {
            text-align: center;
        }

        .game-title {
            font-size: 32px;
            font-weight: 800;
            color: #6366f1;
            margin-bottom: 12px;
        }

        .game-subtitle {
            font-size: 15px;
            color: #737373;
            margin-bottom: 40px;
            font-weight: 500;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #737373;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-start-screen" id="startScreen">
            <div class="start-content">
                <div class="game-title">Git Merge Game</div>
                <div class="game-subtitle">Ï∂©Îèå Ìï¥Í≤∞ ÌÉÄÏûÑÏñ¥ÌÉù Î∞∞ÌãÄ</div>
                
                <div class="difficulty-selector">
                    <div class="progress-title">ÎÇúÏù¥ÎèÑ ÏÑ†ÌÉù</div>
                    <div class="difficulty-buttons">
                        <button class="btn difficulty-btn easy active" data-difficulty="EASY">Easy</button>
                        <button class="btn difficulty-btn normal" data-difficulty="NORMAL">Normal</button>
                        <button class="btn difficulty-btn hard" data-difficulty="HARD">Hard</button>
                        <button class="btn difficulty-btn hell" data-difficulty="HELL">Hell</button>
                    </div>
                </div>
                
                <button class="btn primary" id="startGameBtn">Í≤åÏûÑ ÏãúÏûë</button>
            </div>
        </div>

        <div class="header">
            <div class="logo">Git Merge Game</div>
            <div class="game-info">
                <div class="timer">‚è∞ <span id="timer">05:00</span></div>
                <div class="score">üéØ <span id="score">1000</span>Ï†ê</div>
            </div>
        </div>

        <div class="sidebar">
            <div class="progress-title">Ï∂©Îèå Î™©Î°ù</div>
            <ul class="conflicts-list" id="conflictsList">
                <li class="conflict-item active" data-file="utils.js">
                    <div class="conflict-filename">utils.js</div>
                    <div class="conflict-status">3-5 lines</div>
                </li>
                <li class="conflict-item" data-file="service.js">
                    <div class="conflict-filename">service.js</div>
                    <div class="conflict-status">12-18 lines</div>
                </li>
                <li class="conflict-item resolved" data-file="config.js">
                    <div class="conflict-filename">config.js</div>
                    <div class="conflict-status resolved">‚úì Ìï¥Í≤∞ÏôÑÎ£å</div>
                </li>
            </ul>
        </div>

        <div class="editor-area">
            <textarea class="editor" id="codeEditor" placeholder="Ï∂©ÎèåÏù¥ Î∞úÏÉùÌïú ÏΩîÎìúÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§...">
<<<<<<< HEAD
function calculateTotal(items) {
    return items.reduce((sum, item) => sum + item.cost, 0);
}
=======
function calculateTotal(items) {
    return items.reduce((sum, item) => sum + item.amount, 0);
}
>>>>>>> incoming</textarea>
        </div>

        <div class="status-panel">
            <div class="progress-section">
                <div class="progress-title">ÏßÑÌñâÎ•†</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 33%"></div>
                </div>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <span class="stat-label">Ìï¥Í≤∞ÏôÑÎ£å</span>
                    <span class="stat-value">1 / 3</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Ï†ïÌôïÎèÑ</span>
                    <span class="stat-value">85%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÍπîÎÅîÌï®</span>
                    <span class="stat-value">92%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÏÜåÏöîÏãúÍ∞Ñ</span>
                    <span class="stat-value">2:34</span>
                </div>
            </div>
        </div>

        <div class="footer">
            <button class="btn" id="skipBtn">Ïä§ÌÇµ</button>
            <button class="btn primary" id="submitBtn">Ï†úÏ∂ú</button>
            <button class="btn danger" id="giveupBtn">Ìè¨Í∏∞</button>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8081/api/game';
        let currentSession = null;
        let currentConflicts = [];
        let activeConflictIndex = 0;
        let gameTimer = null;

        document.getElementById('startGameBtn').addEventListener('click', startGame);
        document.getElementById('submitBtn').addEventListener('click', submitResolution);
        
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });

        async function startGame() {
            const difficulty = document.querySelector('.difficulty-btn.active').dataset.difficulty;
            
            try {
                const response = await fetch(API_URL + '/start', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({userId: 1, difficulty: difficulty})
                });
                
                const data = await response.json();
                currentSession = data.sessionId;
                currentConflicts = data.conflicts;
                
                document.getElementById('startScreen').style.display = 'none';
                loadConflict(0);
                startTimer(data.timeLimit);
                
            } catch (error) {
                console.error('Í≤åÏûÑ ÏãúÏûë Ïã§Ìå®:', error);
            }
        }

        function loadConflict(index) {
            if (!currentConflicts[index]) return;
            
            const conflict = currentConflicts[index];
            document.getElementById('codeEditor').value = conflict.conflictMarkers;
            
            const items = document.querySelectorAll('.conflict-item');
            items.forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });
            
            activeConflictIndex = index;
        }

        async function submitResolution() {
            const resolution = document.getElementById('codeEditor').value;
            const conflict = currentConflicts[activeConflictIndex];
            
            try {
                const response = await fetch(API_URL + '/resolve', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        sessionId: currentSession,
                        fileName: conflict.fileName,
                        resolution: resolution
                    })
                });
                
                const result = await response.json();
                
                if (result.correct) {
                    const items = document.querySelectorAll('.conflict-item');
                    items[activeConflictIndex].classList.add('resolved');
                    items[activeConflictIndex].querySelector('.conflict-status').textContent = '‚úì Ìï¥Í≤∞ÏôÑÎ£å';
                    items[activeConflictIndex].querySelector('.conflict-status').classList.add('resolved');
                }
                
                if (result.gameCompleted) {
                    finishGame();
                } else {
                    loadConflict(activeConflictIndex + 1);
                }
                
            } catch (error) {
                console.error('Ï†úÏ∂ú Ïã§Ìå®:', error);
            }
        }

        async function finishGame() {
            try {
                const response = await fetch(API_URL + '/finish/' + currentSession, {
                    method: 'POST'
                });
                
                const result = await response.json();
                clearInterval(gameTimer);
                
                alert(`Í≤åÏûÑ ÏôÑÎ£å!\nÏ¥ù Ï†êÏàò: ${result.totalScore}Ï†ê\nÏ†ïÌôïÎèÑ: ${result.accuracy}%`);
                location.reload();
                
            } catch (error) {
                console.error('Í≤åÏûÑ Ï¢ÖÎ£å Ïã§Ìå®:', error);
            }
        }

        function startTimer(timeLimit) {
            let timeLeft = timeLimit;
            
            gameTimer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('timer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    finishGame();
                }
                
                timeLeft--;
            }, 1000);
        }
    </script>
</body>
</html>
