<!DOCTYPE html>
<html lang="ko">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Git Merge Battle</title>
   <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
   <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" rel="stylesheet">
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }
       
       body {
           font-family: "Pretendard", -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
           background: #0a0a0a;
           color: #e0e0e0;
           min-height: 100vh;
           overflow-x: hidden;
       }
       
       .container {
           max-width: 900px;
           margin: 0 auto;
           padding: 40px 20px;
       }
       
       .screen {
           display: none;
           background: #111111;
           border: 1px solid #333333;
           border-radius: 8px;
           padding: 60px 40px;
           margin-bottom: 20px;
       }
       
       .screen.active {
           display: block;
           animation: fadeIn 0.5s ease;
       }
       
       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(20px); }
           to { opacity: 1; transform: translateY(0); }
       }
       
       .title {
           text-align: center;
           font-size: 3rem;
           color: #ffffff;
           margin-bottom: 10px;
           font-weight: 700;
       }
       
       .subtitle {
           text-align: center;
           color: #888888;
           margin-bottom: 50px;
           font-size: 1.1rem;
           font-weight: 400;
       }
       
       .input-group {
           margin-bottom: 30px;
       }
       
       .input-group label {
           display: block;
           margin-bottom: 8px;
           font-weight: 600;
           color: #cccccc;
           font-size: 0.9rem;
           text-transform: uppercase;
           letter-spacing: 1px;
       }
       
       .input-group input {
           width: 100%;
           padding: 16px 20px;
           background: #1a1a1a;
           border: 1px solid #333333;
           border-radius: 6px;
           color: #e0e0e0;
           font-size: 1.1rem;
           font-family: inherit;
           transition: all 0.3s ease;
       }
       
       .input-group input:focus {
           outline: none;
           border-color: #666666;
       }
       
       .btn {
           background: #333333;
           color: #ffffff;
           border: none;
           padding: 16px 32px;
           border-radius: 6px;
           font-size: 1rem;
           font-weight: 600;
           cursor: pointer;
           transition: all 0.3s ease;
           width: 100%;
           margin-bottom: 15px;
           text-transform: uppercase;
           letter-spacing: 1px;
           font-family: inherit;
       }
       
       .btn:hover {
           background: #444444;
           transform: translateY(-2px);
       }
       
       .btn:active {
           transform: translateY(0);
       }
       
       .btn:disabled {
           background: #222222;
           color: #666666;
           cursor: not-allowed;
           transform: none;
       }
       
       .btn.primary {
           background: #666666;
           color: #ffffff;
       }
       
       .btn.primary:hover {
           background: #777777;
       }
       
       .btn.secondary {
           background: #555555;
       }
       
       .btn.secondary:hover {
           background: #666666;
       }
       
       .btn.dark {
           background: #222222;
           color: #e0e0e0;
           border: 1px solid #444444;
       }
       
       .btn.dark:hover {
           background: #333333;
       }
       
       .mode-grid {
           display: grid;
           grid-template-columns: 1fr 1fr;
           gap: 20px;
           margin: 30px 0;
       }
       
       .mode-btn {
           padding: 40px 20px;
           background: #1a1a1a;
           border: 2px solid #333333;
           border-radius: 8px;
           text-align: center;
           cursor: pointer;
           transition: all 0.3s ease;
           color: #e0e0e0;
       }
       
       .mode-btn:hover {
           border-color: #666666;
           background: #222222;
           transform: translateY(-3px);
       }
       
       .mode-icon {
           font-size: 3rem;
           margin-bottom: 15px;
       }
       
       .mode-name {
           font-size: 1.3rem;
           font-weight: 700;
           margin-bottom: 8px;
           color: #ffffff;
       }
       
       .mode-desc {
           color: #888888;
           font-size: 0.9rem;
       }
       
       .difficulty-grid {
           display: grid;
           grid-template-columns: 1fr 1fr;
           gap: 15px;
           margin: 30px 0;
       }
       
       .difficulty-btn {
           padding: 25px 20px;
           background: #1a1a1a;
           border: 2px solid #333333;
           border-radius: 8px;
           text-align: center;
           cursor: pointer;
           transition: all 0.3s ease;
       }
       
       .difficulty-btn:hover {
           transform: translateY(-2px);
       }
       
       .difficulty-btn.selected {
           border-color: #666666;
           background: #222222;
       }
       
       .difficulty-name {
           font-size: 1.2rem;
           font-weight: 700;
           margin-bottom: 5px;
           color: #e0e0e0;
       }
       
       .difficulty-desc {
           color: #888888;
           font-size: 0.8rem;
       }
       
       .room-info {
           background: #1a1a1a;
           border: 1px solid #333333;
           border-radius: 8px;
           padding: 30px;
           margin: 30px 0;
           text-align: center;
       }
       
       .room-id {
           font-size: 2rem;
           font-weight: 700;
           color: #ffffff;
           margin-bottom: 10px;
           letter-spacing: 3px;
       }
       
       .room-desc {
           color: #888888;
           margin-bottom: 20px;
       }
       
       .players-section {
           margin-top: 30px;
       }
       
       .players-title {
           font-size: 1.1rem;
           color: #cccccc;
           margin-bottom: 15px;
           text-transform: uppercase;
           letter-spacing: 1px;
       }
       
       .player-list {
           background: #1a1a1a;
           border-radius: 6px;
           padding: 20px;
       }
       
       .player-item {
           display: flex;
           justify-content: space-between;
           align-items: center;
           padding: 12px 0;
           border-bottom: 1px solid #333333;
       }
       
       .player-item:last-child {
           border-bottom: none;
       }
       
       .player-name {
           font-weight: 600;
           color: #e0e0e0;
       }
       
       .player-status {
           padding: 4px 12px;
           border-radius: 12px;
           font-size: 0.8rem;
           font-weight: 600;
           text-transform: uppercase;
       }
       
       .status-ready {
           background: #666666;
           color: #ffffff;
       }
       
       .status-waiting {
           background: #333333;
           color: #888888;
       }
       
       .game-area {
           margin-top: 30px;
       }
       
       .status-bar {
           display: grid;
           grid-template-columns: repeat(4, 1fr);
           gap: 15px;
           margin-bottom: 30px;
       }
       
       .status-item {
           background: #1a1a1a;
           border: 1px solid #333333;
           border-radius: 6px;
           padding: 15px;
           text-align: center;
       }
       
       .status-label {
           font-size: 0.8rem;
           color: #888888;
           text-transform: uppercase;
           letter-spacing: 1px;
           margin-bottom: 5px;
       }
       
       .status-value {
           font-size: 1.5rem;
           font-weight: 700;
           color: #ffffff;
       }
       
       .conflict-container {
           background: #1a1a1a;
           border: 1px solid #333333;
           border-radius: 8px;
           overflow: hidden;
       }
       
       .conflict-header {
           background: #222222;
           color: #ffffff;
           padding: 15px 20px;
           font-weight: 700;
           font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
           border-bottom: 1px solid #333333;
       }
       
       .code-editor {
           width: 100%;
           height: 350px;
           background: #0d1117;
           color: #e6edf3;
           border: none;
           padding: 20px;
           font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
           font-size: 14px;
           line-height: 1.6;
           resize: none;
       }
       
       .code-editor:focus {
           outline: none;
           background: #0d1117;
       }
       
       .result-message {
           margin: 20px 0;
           padding: 20px;
           border-radius: 6px;
           font-weight: 600;
           text-align: center;
           animation: slideIn 0.3s ease;
       }
       
       @keyframes slideIn {
           from { opacity: 0; transform: translateX(-20px); }
           to { opacity: 1; transform: translateX(0); }
       }
       
       .result-message.success {
           background: rgba(255, 255, 255, 0.1);
           color: #ffffff;
           border: 1px solid rgba(255, 255, 255, 0.3);
       }
       
       .result-message.error {
           background: rgba(128, 128, 128, 0.1);
           color: #cccccc;
           border: 1px solid rgba(128, 128, 128, 0.3);
       }
       
       .final-result {
           text-align: center;
           margin: 40px 0;
       }
       
       .final-score {
           font-size: 4rem;
           font-weight: 700;
           color: #ffffff;
           margin-bottom: 20px;
       }
       
       .result-stats {
           display: grid;
           grid-template-columns: repeat(3, 1fr);
           gap: 20px;
           margin: 30px 0;
       }
       
       .result-stat {
           background: #1a1a1a;
           border: 1px solid #333333;
           border-radius: 6px;
           padding: 20px;
           text-align: center;
       }
       
       .result-stat-value {
           font-size: 2rem;
           font-weight: 700;
           color: #ffffff;
           margin-bottom: 5px;
       }
       
       .result-stat-label {
           color: #888888;
           font-size: 0.9rem;
           text-transform: uppercase;
           letter-spacing: 1px;
       }
   </style>
</head>
<body>
   <div class="container">
       <div class="screen active" id="nicknameScreen">
           <h1 class="title">Git Merge Battle</h1>
           <p class="subtitle">충돌 해결 배틀 시작</p>
           
           <div class="input-group">
               <label>닉네임</label>
               <input type="text" id="nicknameInput" placeholder="닉네임을 입력하세요" maxlength="12">
           </div>
           
           <button class="btn primary" id="enterBtn" disabled>입장하기</button>
       </div>

       <div class="screen" id="modeScreen">
           <h1 class="title">모드 선택</h1>
           <p class="subtitle">게임 모드를 선택하세요</p>
           
           <div class="mode-grid">
               <div class="mode-btn" id="soloBtn">
                   <div class="mode-icon">⚡</div>
                   <div class="mode-name">혼자하기</div>
                   <div class="mode-desc">혼자서 실력 향상</div>
               </div>
               <div class="mode-btn" id="multiBtn">
                   <div class="mode-icon">🔥</div>
                   <div class="mode-name">실시간 매칭</div>
                   <div class="mode-desc">다른 플레이어와 대전</div>
               </div>
           </div>
           
           <button class="btn dark" id="backFromModeBtn">← 뒤로가기</button>
       </div>

       <div class="screen" id="difficultyScreen">
           <h1 class="title">난이도 선택</h1>
           <p class="subtitle">도전할 난이도를 선택하세요</p>
           
           <div class="difficulty-grid">
               <div class="difficulty-btn" data-difficulty="EASY">
                   <div class="difficulty-name">쉬움</div>
                   <div class="difficulty-desc">3개 충돌</div>
               </div>
               <div class="difficulty-btn" data-difficulty="NORMAL">
                   <div class="difficulty-name">보통</div>
                   <div class="difficulty-desc">5개 충돌</div>
               </div>
               <div class="difficulty-btn" data-difficulty="HARD">
                   <div class="difficulty-name">어려움</div>
                   <div class="difficulty-desc">8개 충돌</div>
               </div>
               <div class="difficulty-btn" data-difficulty="HELL">
                   <div class="difficulty-name">지옥</div>
                   <div class="difficulty-desc">12개 충돌</div>
               </div>
           </div>
           
           <button class="btn primary" id="startGameBtn" disabled>게임 시작</button>
           <button class="btn dark" id="backFromDiffBtn">← 뒤로가기</button>
       </div>

       <div class="screen" id="roomScreen">
           <h1 class="title">대기실</h1>
           
           <div class="room-info">
               <div class="room-id" id="roomId">ROOM Alpha 7429</div>
               <div class="room-desc">이 방 코드를 친구에게 공유하세요</div>
               <button class="btn dark" style="width: auto; padding: 8px 16px; font-size: 0.9rem;">코드 복사</button>
           </div>
           
           <div class="players-section">
               <div class="players-title">참가자 목록</div>
               <div class="player-list" id="playerList">
                   <div class="player-item">
                       <span class="player-name">플레이어를 기다리는 중...</span>
                       <span class="player-status status-waiting">연결중</span>
                   </div>
               </div>
           </div>
           
           <button class="btn primary" id="readyBtn" disabled>준비완료</button>
           <button class="btn secondary" id="leaveRoomBtn">방 나가기</button>
       </div>

       <div class="screen" id="gameScreen">
           <h1 class="title">게임 진행중</h1>
           
           <div class="status-bar">
               <div class="status-item">
                   <div class="status-label">문제</div>
                   <div class="status-value" id="questionStatus">1/3</div>
               </div>
               <div class="status-item">
                   <div class="status-label">정답</div>
                   <div class="status-value" id="correctCount">0</div>
               </div>
               <div class="status-item">
                   <div class="status-label">오답</div>
                   <div class="status-value" id="wrongCount">0</div>
               </div>
               <div class="status-item">
                   <div class="status-label">시간</div>
                   <div class="status-value" id="timeElapsed">00:00</div>
               </div>
           </div>
           
           <div class="conflict-container">
               <div class="conflict-header" id="fileHeader">src/main/conflict.js</div>
               <textarea class="code-editor" id="codeEditor" placeholder="// 충돌을 해결하고 마커를 제거하세요..."></textarea>
           </div>
           
           <div class="result-message" id="resultMessage" style="display: none;"></div>
           
           <button class="btn primary" id="submitBtn">답안 제출</button>
       </div>

       <div class="screen" id="resultScreen">
           <h1 class="title">게임 완료</h1>
           
           <div class="final-result">
               <div class="final-score" id="finalScore">2847</div>
               
               <div class="result-stats">
                   <div class="result-stat">
                       <div class="result-stat-value" id="accuracyRate">85%</div>
                       <div class="result-stat-label">정확도</div>
                   </div>
                   <div class="result-stat">
                       <div class="result-stat-value" id="finalTime">02:34</div>
                       <div class="result-stat-label">소요시간</div>
                   </div>
                   <div class="result-stat">
                       <div class="result-stat-value" id="totalSolved">7/8</div>
                       <div class="result-stat-label">해결률</div>
                   </div>
               </div>
           </div>
           
           <button class="btn primary" id="playAgainBtn">다시하기</button>
           <button class="btn dark" id="mainMenuBtn">메인 메뉴</button>
       </div>
   </div>

   <script>
       let nickname = '';
       let gameMode = '';
       let selectedDifficulty = '';
       let stompClient = null;
       let currentRoom = null;
       let currentSession = null;
       let gameStartTime = null;
       
       const roomNames = ['Alpha', 'Beta', 'Gamma', 'Delta', 'Omega', 'Sigma', 'Lambda', 'Theta'];
       
       function generateRoomName() {
           const name = roomNames[Math.floor(Math.random() * roomNames.length)];
           const number = Math.floor(Math.random() * 9000) + 1000;
           return `ROOM ${name} ${number}`;
       }
       
       document.getElementById('nicknameInput').addEventListener('input', function() {
           const value = this.value.trim();
           document.getElementById('enterBtn').disabled = value.length < 2;
       });
       
       document.getElementById('enterBtn').addEventListener('click', function() {
           nickname = document.getElementById('nicknameInput').value.trim();
           if (nickname) {
               showScreen('modeScreen');
           }
       });
       
       document.getElementById('soloBtn').addEventListener('click', function() {
           gameMode = 'solo';
           showScreen('difficultyScreen');
       });
       
       document.getElementById('multiBtn').addEventListener('click', function() {
           gameMode = 'multi';
           showScreen('difficultyScreen');
       });
       
       document.getElementById('backFromModeBtn').addEventListener('click', function() {
           showScreen('nicknameScreen');
       });
       
       document.getElementById('backFromDiffBtn').addEventListener('click', function() {
           showScreen('modeScreen');
       });
       
       document.querySelectorAll('.difficulty-btn').forEach(btn => {
           btn.addEventListener('click', function() {
               document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
               this.classList.add('selected');
               selectedDifficulty = this.dataset.difficulty;
               document.getElementById('startGameBtn').disabled = false;
           });
       });
       
       document.getElementById('startGameBtn').addEventListener('click', function() {
           if (gameMode === 'solo') {
               startSoloGame();
           } else {
               showRoomScreen();
           }
       });
       
       document.getElementById('readyBtn').addEventListener('click', function() {
           this.disabled = true;
           this.textContent = '준비 완료!';
           setTimeout(() => showScreen('gameScreen'), 2000);
       });
       
       document.getElementById('leaveRoomBtn').addEventListener('click', function() {
           showScreen('modeScreen');
       });
       
       document.getElementById('submitBtn').addEventListener('click', function() {
           const answer = document.getElementById('codeEditor').value.trim();
           if (answer) {
               submitAnswer(answer);
           }
       });
       
       document.getElementById('playAgainBtn').addEventListener('click', function() {
           showScreen('modeScreen');
           resetGame();
       });
       
       document.getElementById('mainMenuBtn').addEventListener('click', function() {
           showScreen('nicknameScreen');
           resetGame();
       });
       
       function showScreen(screenId) {
           document.querySelectorAll('.screen').forEach(screen => {
               screen.classList.remove('active');
           });
           document.getElementById(screenId).classList.add('active');
       }
       
       function showRoomScreen() {
           const roomName = generateRoomName();
           document.getElementById('roomId').textContent = roomName;
           
           setTimeout(() => {
               document.getElementById('playerList').innerHTML = `
                   <div class="player-item">
                       <span class="player-name">${nickname}</span>
                       <span class="player-status status-waiting">대기중</span>
                   </div>
                   <div class="player-item">
                       <span class="player-name">플레이어${Math.floor(Math.random() * 1000)}</span>
                       <span class="player-status status-waiting">연결중</span>
                   </div>
               `;
               document.getElementById('readyBtn').disabled = false;
           }, 1500);
           
           showScreen('roomScreen');
       }
       
       async function startSoloGame() {
           try {
               const response = await fetch('/api/quick/start', {
                   method: 'POST',
                   headers: { 'Content-Type': 'application/json' },
                   body: JSON.stringify({
                       nickname: nickname,
                       difficulty: selectedDifficulty
                   })
               });
               
               if (response.ok) {
                   const data = await response.json();
                   currentSession = data;
                   gameStartTime = Date.now();
                   displayConflict(data.currentConflict);
                   showScreen('gameScreen');
                   startTimer();
               } else {
                   alert('게임 시작에 실패했습니다');
               }
           } catch (error) {
               console.error('게임 시작 오류:', error);
               alert('서버 연결에 문제가 있습니다');
           }
       }
       
       function displayConflict(conflict) {
           document.getElementById('fileHeader').textContent = `src/main/${conflict.fileName}`;
           document.getElementById('codeEditor').value = conflict.conflictMarkers;
           document.getElementById('questionStatus').textContent = 
               `${currentSession.currentIndex + 1}/${currentSession.totalConflicts}`;
       }
       
       async function submitAnswer(answer) {
           if (gameMode === 'solo') {
               try {
                   const response = await fetch('/api/quick/submit', {
                       method: 'POST',
                       headers: { 'Content-Type': 'application/json' },
                       body: JSON.stringify({
                           sessionId: currentSession.sessionId,
                           answer: answer
                       })
                   });
                   
                   if (response.ok) {
                       const result = await response.json();
                       showResult(result);
                       
                       if (result.correct) {
                           updateCorrectCount();
                       } else {
                           updateWrongCount();
                       }
                       
                       if (result.gameOver) {
                           setTimeout(showFinalResult, 2000);
                       }
                   }
               } catch (error) {
                   console.error('답안 제출 오류:', error);
               }
           }
       }
       
       function showResult(result) {
           const messageDiv = document.getElementById('resultMessage');
           messageDiv.textContent = result.message;
           messageDiv.className = 'result-message ' + (result.correct ? 'success' : 'error');
           messageDiv.style.display = 'block';
           
           setTimeout(() => {
               messageDiv.style.display = 'none';
           }, 3000);
       }
       
       function updateCorrectCount() {
           const current = parseInt(document.getElementById('correctCount').textContent);
           document.getElementById('correctCount').textContent = current + 1;
       }
       
       function updateWrongCount() {
           const current = parseInt(document.getElementById('wrongCount').textContent);
           document.getElementById('wrongCount').textContent = current + 1;
       }
       
       async function showFinalResult() {
           try {
               const response = await fetch(`/api/quick/result/${currentSession.sessionId}`);
               if (response.ok) {
                   const result = await response.json();
                   
                   document.getElementById('finalScore').textContent = result.totalScore;
                   document.getElementById('accuracyRate').textContent = 
                       Math.round((result.correctCount / result.totalQuestions) * 100) + '%';
                   document.getElementById('finalTime').textContent = 
                       Math.floor(result.elapsedSeconds / 60) + ':' + 
                       String(result.elapsedSeconds % 60).padStart(2, '0');
                   document.getElementById('totalSolved').textContent = 
                       `${result.correctCount}/${result.totalQuestions}`;
                   
                   showScreen('resultScreen');
               }
           } catch (error) {
               console.error('결과 조회 오류:', error);
               showScreen('resultScreen');
           }
       }
       
       function startTimer() {
           setInterval(() => {
               if (gameStartTime) {
                   const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
                   const minutes = Math.floor(elapsed / 60);
                   const seconds = elapsed % 60;
                   document.getElementById('timeElapsed').textContent = 
                       String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
               }
           }, 1000);
       }
       
       function resetGame() {
           currentSession = null;
           currentRoom = null;
           gameStartTime = null;
           selectedDifficulty = '';
           
           document.getElementById('correctCount').textContent = '0';
           document.getElementById('wrongCount').textContent = '0';
           document.getElementById('timeElapsed').textContent = '00:00';
           document.getElementById('codeEditor').value = '';
           document.getElementById('resultMessage').style.display = 'none';
           
           document.querySelectorAll('.difficulty-btn').forEach(btn => {
               btn.classList.remove('selected');
           });
           document.getElementById('startGameBtn').disabled = true;
       }
   </script>
</body>
</html>
