<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Merge Game</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui; background: #0a0a0a; color: #fff; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        .btn { background: #333; color: #fff; border: 1px solid #555; border-radius: 6px; padding: 12px 20px; cursor: pointer; }
        .btn:hover { background: #444; }
        .btn.primary { background: #0066cc; border-color: #0066cc; }
        .game-area { display: none; grid-template-columns: 1fr 250px; gap: 20px; margin-top: 20px; }
        .code-editor { width: 100%; min-height: 400px; background: #111; color: #fff; border: 1px solid #333; padding: 16px; font-family: monospace; }
        .sidebar { background: #111; border: 1px solid #333; border-radius: 6px; padding: 16px; }
        .difficulty-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px 0; }
        .difficulty-btn { padding: 20px 10px; text-align: center; background: #111; border: 1px solid #333; cursor: pointer; }
        .difficulty-btn.selected { border-color: #0066cc; background: #001a33; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Git Merge Game</h1>
        
        <div class="difficulty-grid">
            <div class="difficulty-btn selected" data-difficulty="EASY">쉬움<br><small>3개</small></div>
            <div class="difficulty-btn" data-difficulty="NORMAL">보통<br><small>5개</small></div>
            <div class="difficulty-btn" data-difficulty="HARD">어려움<br><small>8개</small></div>
            <div class="difficulty-btn" data-difficulty="HELL">지옥<br><small>12개</small></div>
        </div>
        
        <button class="btn primary" id="startBtn">게임 시작</button>
        
        <div class="game-area" id="gameArea">
            <div>
                <textarea class="code-editor" id="codeEditor"></textarea>
                <button class="btn primary" id="checkBtn">해결 확인</button>
            </div>
            <div class="sidebar">
                <div id="fileInfo">파일: game.js</div>
                <div id="progress">진행: 1/3</div>
                <button class="btn" id="prevBtn">이전</button>
                <button class="btn" id="nextBtn">다음</button>
            </div>
        </div>
    </div>

    <script>
        let gameData = null;
        let currentIndex = 0;
        let difficulty = 'EASY';

        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                difficulty = btn.dataset.difficulty;
            };
        });

        document.getElementById('startBtn').onclick = async () => {
            try {
                const response = await fetch('/api/game/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: 1, difficulty })
                });
                gameData = await response.json();
                document.getElementById('gameArea').style.display = 'grid';
                showConflict(0);
            } catch (error) {
                alert('게임 시작 실패: ' + error.message);
            }
        };

        document.getElementById('checkBtn').onclick = async () => {
            const solution = document.getElementById('codeEditor').value;
            const conflict = gameData.conflicts[currentIndex];
            
            try {
                const response = await fetch('/api/game/resolve', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        sessionId: gameData.sessionId,
                        fileName: conflict.fileName,
                        resolution: solution
                    })
                });
                const result = await response.json();
                
                if (result.correct) {
                    alert('정답입니다!');
                    if (result.gameCompleted) {
                        alert('게임 완료!');
                        location.reload();
                    }
                } else {
                    alert('틀렸습니다. 다시 시도하세요.');
                }
            } catch (error) {
                alert('확인 실패: ' + error.message);
            }
        };

        document.getElementById('prevBtn').onclick = () => showConflict(currentIndex - 1);
        document.getElementById('nextBtn').onclick = () => showConflict(currentIndex + 1);

        function showConflict(index) {
            if (!gameData || index < 0 || index >= gameData.conflicts.length) return;
            
            currentIndex = index;
            const conflict = gameData.conflicts[index];
            
            document.getElementById('codeEditor').value = conflict.conflictMarkers;
            document.getElementById('fileInfo').textContent = `파일: ${conflict.fileName}`;
            document.getElementById('progress').textContent = `진행: ${index + 1}/${gameData.conflicts.length}`;
            
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === gameData.conflicts.length - 1;
        }
    </script>
</body>
</html>
